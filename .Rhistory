library(data.table)
DT = data.table(x=rep(c("b","a","c"),each=3), y=c(1,3,6), v=1:9)
DT[order(-x, na.last="D")]
DT[order(-x, decreasing="D")]
?forder
forder
data.table::forder
data.table:::forder
forderv
data.table:::forderv
?sorted
data.table:::is.sorted
x <- matrix(nrow = 5, ncol = 2)
x[c(1,3,5), ] <- matrix(2, nrow = 3, ncol = 2)
x
x[c(1,3,5), ] <- matrix(2, nrow = 3, ncol = 2)
x[-c(2, 4), ] <- matrix(2, nrow = 3, ncol = 2)
x
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
?matrix
x <- matrix(nrow = 5, ncol = 2)
x
rownames(x)[-c(2, 4)] <- c("a", "b", "c")
x
rownames(x)[-c(2, 4)]
rownames(x)
x <- matrix(nrow = 5, ncol = 2, dimnames = list("", c("a","b")))
x <- matrix(nrow = 5, ncol = 2, dimnames = list(rep("", 5), c("a","b")))
x
x <- matrix(nrow = 5, ncol = 2)
rownames(x) <- ""
x <- matrix(nrow = 5, ncol = 2, dimnames = list(rep("", 5), c("a","b")))
x'
x
rownames(x)[-c(2, 4)]
rownames(x)[-c(2, 4)] <- c("a", "b", "c")
x
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
print(test_dt, by = c("a", "b"))
data.table:::is.sorted
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
data.table:::is.sorted(sample(3))
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
print(test_dt, by = c("a", "b"))
options(datatable.print.byfill="")
opts = c("datatable.verbose"="FALSE",            # datatable.<argument name>
"datatable.nomatch"="NA_integer_",      # datatable.<argument name>
"datatable.optimize"="Inf",             # datatable.<argument name>
"datatable.print.nrows"="100L",         # datatable.<argument name>
"datatable.print.topn"="5L",            # datatable.<argument name>
"datatable.print.class"="FALSE",        # for print.data.table
"datatable.print.byfill"="",            # for print.data.table
"datatable.allow.cartesian"="FALSE",    # datatable.<argument name>
"datatable.dfdispatchwarn"="TRUE",                   # not a function argument
"datatable.warnredundantby"="TRUE",                  # not a function argument
"datatable.alloccol"="quote(max(100L,ncol(DT)+64L))",# argument 'n' of alloc.col. Allocate at least 64 spare slots by default. Needs to be 100L floor to save small object reallocs.
"datatable.integer64"="'integer64'",    # datatable.<argument name>    integer64|double|character
"datatable.showProgress"="1L",          # in fread
"datatable.auto.index"="TRUE",          # DT[col=="val"] to auto add index so 2nd time faster
"datatable.fread.datatable"="TRUE",
"datatable.old.bywithoutby"="FALSE",    # temp rollback method for code migration, will be removed in future
"datatable.fread.dec.experiment"="TRUE", # temp.  will remove once stable
"datatable.fread.dec.locale"=if (.Platform$OS.type=="unix") "'fr_FR.utf8'" else "'French_France.1252'",
"datatable.prettyprint.char" = NULL # FR #1091
)
opts
options(datatable.print.byfill="asdf")
getOption("datatable.print.byfill")
eval(parse(text=paste("options(","datatable.print.byfill","=","\"\"",")"),sep=""))
eval(parse(text=paste("options(","datatable.print.byfill","=","\"\"",")",sep=""))
eval(parse(text=paste("options(","datatable.print.byfill","=","\"\"",")",sep="")))
getOption("datatable.print.byfill")
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
print(test_dt, by = c("a", "b"))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
options(datatable.print.byfill = "-")
print(test_dt, by = c("a", "b"))
?data.table
long_test <- data.table(a = sample(letters, 1e4, rep = TRUE),
b = runif(1e4))
print(long_test, by = "a")
long_test <- data.table(a = sample(letters, 1e4, rep = TRUE),
b = runif(1e4))
print(long_test, keyby = "a")
print(long_test[order(a)], by = "a")
long_test[ , if (.BY == "a") .I[1L] else .I, by = "a"]
long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]
print(long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]], by = "a")
print(long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1], by = "a")
print(long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1][order(a)], by = "a")
long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1][order(a)]
rbind(head(long_test, 5), tail(long_test, 5))
x<-long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1][order(a)]
rbind(head(x, 5), tail(x, 5))
rbind(head(x, 5), tail(x, 5))[ , .N, by = "a"]
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
long_test <- data.table(a = sample(letters, 1e4, rep = TRUE),
b = runif(1e4))
print(long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1][order(a)], by = "a")
options(datatable.print.byfill = "-")
print(test_dt, by = c("a", "b"))
x <- 1:3
x <- x[-which(x==4)]
x
x
x <- 1:3
if (any(idx <- x == 4)) x <- x[-which(idx)]
x
if (any(idx <- x == 3)) x <- x[-which(idx)]
x
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
test_dt <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(test_dt, by = "a")
print(test_dt, by = "a,b")
long_test <- data.table(a = sample(letters, 1e4, rep = TRUE),
b = runif(1e4))
print(long_test[long_test[ , if (.BY == "a") .I[1L] else .I, keyby = "a"]$V1][order(a)], by = "a")
options(datatable.print.byfill = "-")
print(test_dt, by = c("a", "b"))
long_test1 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
print(long_test1, by = "a")
options(datatable.print.byfill = "")
long_test1 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
print(long_test1, by = "a")
print(long_test1[a!="c"], by = "a")
dt <- data.table(x=1:5, y=6:10)
setnames(dt, "y", "")
d
dt
setnames(dt, "x", "")
dt
is.null(names(x))
is.null(names(dt))
print(test_dt[sample(a)], by = "a")
print(test_dt[sample(.N)], by = "a")
print(test_dt[.N:1], by = "a")
DT1 <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
print(DT1[.N:1], by = "a")
print(DT1, by = "a")
print(DT1, by = "a,b")
capture.output(print(DT1, by = "a")
capture.output(print(DT1, by = "a"))
dput(capture.output(print(DT1, by = "a")))
dput(capture.output(print(DT1, by = "a,b")))
print(DT1[.N:1], by = "a")
set.seed(98549)
DT1 <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
dput(capture.output(print(DT1, by = "a")))
dput(capture.output(print(DT1, by = "a,b")))
print(DT1[.N:1], by = "a")
DT2 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
print(DT2, by = "a")
print(DT2[a!="c"], by = "a")
set.seed(98549)
DT1 <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
dput(capture.output(print(DT1, by = "a")))
dput(capture.output(print(DT1, by = "a,b")))
print(DT1[.N:1], by = "a")
DT2 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
dput(capture.output(print(DT2, by = "a")))
dput(capture.output(print(DT2[a!="c"], by = "a")))
options(datatable.print.byfill = "-")
dput(capture.output(print(DT1, by = c("a", "b"))))
dput(capture.output(print(DT2, by = "a")))
print(DT2, by = "a")
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
set.seed(98549)
DT1 <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
dput(capture.output(print(DT1, by = "a")))
dput(capture.output(print(DT1, by = "a,b")))
print(DT1[.N:1], by = "a")
DT2 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
dput(capture.output(print(DT2, by = "a")))
dput(capture.output(print(DT2[a!="c"], by = "a")))
options(datatable.print.byfill = "-")
dput(capture.output(print(DT1, by = c("a", "b"))))
print(DT1, by = c("a", "b"))
test.data.table()
library(data.table)
test.data.table()
library(data.table)
set.seed(98549)
DT1 <- data.table(a = rep(c("A", "B"), each = 4),
b = rep(rep(c("A", "B"), 2), c(2, 2, 1, 3)),
c = runif(8))
dput(capture.output(print(DT1, by = "a")))
dput(capture.output(print(DT1, by = "a,b")))
print(DT1[.N:1], by = "a")
DT2 <- data.table(a = c("a", rep("b", 100), rep("c", 10)),
b = runif(111))
dput(capture.output(print(DT2, by = "a")))
dput(capture.output(print(DT2[a!="c"], by = "a")))
options(datatable.print.byfill = "-")
dput(capture.output(print(DT1, by = c("a", "b"))))
devtools::install_github("MichaelChirico/data.table@printby")
library(data.table)
test.data.table()
data.table:::is.sorted(3:1)
data.table:::is.sorted(-3:1)
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {data.table:::is.sorted(srted)
data.table:::is.sorted(unsr)})
library(microbenchmark)
set.seed(10101)
srtd <- sort(sample(1e6, rep = TRUE)) # a sorted test case
unsr <- sample(1e6, rep = TRUE) #an unsorted test case
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {data.table:::is.sorted(srted)
data.table:::is.sorted(unsr)})
library(microbenchmark)
set.seed(10101)
srtd <- sort(sample(1e6, rep = TRUE)) # a sorted test case
unsr <- sample(1e6, rep = TRUE) #an unsorted test case
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {data.table:::is.sorted(srtd)
data.table:::is.sorted(unsr)})
dts <- data.table:::is.sorted
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {dts(srtd); dts(unsr)})
data.table:::is.sorted
.Call(cfsorted, srted)
.Call(Cfsorted, srted)
data.table:::.Call(Cfsorted, srted)
.Call(data.table:::Cfsorted, srted)
.Call(data.table:::Cfsorted, srtd)
data.table:::Cfsorted
dts <- function(x) .Call(data.table:::is.sorted, x)
dts <- function(x) .Call(data.table:::is.sorted, x)
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {dts(srtd); dts(unsr)})
microbenchmark(times = 10L,
josilber = {all(diff(srtd) >= 0)
all(diff(unsr) >= 0)},
mikec = {identical(sort(srtd), srtd)
identical(sort(unsr), unsr)},
baser = {!is.unsorted(srtd)
!is.unsorted(unsr)},
intern = {!.Internal(is.unsorted(srtd, FALSE))
!.Internal(is.unsorted(unsr, FALSE))},
dt = {.Call(data.table:::Cfsorted, srtd)
.Call(data.table:::Cfsorted, unsr)})
?importFrom
??importFrom
dplyr::arrange
dplyr::arrange_
dplyr:::arrange_.tbl_df
dplyr:::arrange_impl
24000/600000
27000/600000
35000/600000
x <- (81/5)^(.25)
x^5 - 81 * x
x
x <- (-81/5)^(.25)
x^5 - 81 * x
x <- -(81/5)^(.25)
x^5 - 81 * x
x <- 5
x^5 - 81 * x
x <- seq(-.05, .05, length.out = 1000)
sec(5 * x)
cos(0)
x <- seq(-.05, .05, length.out = 1000)
plot(x, 6 * x, lwd = 3)
lines(x, 50 * sin(5 * x) / (cos(5 * x) ^ 3))
plot(x, 6 * x, lwd = 3, type = "l")
lines(x, 50 * sin(5 * x) / (cos(5 * x) ^ 3), lwd = 3, col = "red")
x <- seq(-.1, .1, length.out = 1000)
plot(x, 6 * x, lwd = 3, type = "l")
lines(x, 50 * sin(5 * x) / (cos(5 * x) ^ 3), lwd = 3, col = "red")
x <- seq(-.2, .2, length.out = 1000)
plot(x, 6 * x, lwd = 3, type = "l")
lines(x, 50 * sin(5 * x) / (cos(5 * x) ^ 3), lwd = 3, col = "red")
x <- seq(-.5, .5, length.out = 1000)
plot(x, 6 * x, lwd = 3, type = "l")
lines(x, 50 * sin(5 * x) / (cos(5 * x) ^ 3), lwd = 3, col = "red")
ifelse
is.atomic(2 > 1)
is.null(attributes(2>1))
isS4(2 > 1)
rep(c(1,2), length.out = 1)
out_taxes <- fread(wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv",
select=c("Tax Period","Total")
)[`Tax Period`!=2016]
wds<-c(data=(dwd<-"/media/data_drive/")%+%"real_estate/",
proj=mn,
imga=mn%+%"/papers_presentations/round_two/images/analysis/",
imgb=mn%+%"/papers_presentations/round_two/images/balance/",
gis=dwd%+%"gis_data/PA/",
sher=dwd%+%"real_estate/sheriffs_sales/",
cens=dwd%+%"census/")
setwd((mn<-"~/Desktop/research/Sieg_LMI_Real_Estate_Delinquency/")%+%
"analysis_code/")
wds<-c(data=(dwd<-"/media/data_drive/")%+%"real_estate/",
proj=mn,
imga=mn%+%"/papers_presentations/round_two/images/analysis/",
imgb=mn%+%"/papers_presentations/round_two/images/balance/",
gis=dwd%+%"gis_data/PA/",
sher=dwd%+%"real_estate/sheriffs_sales/",
cens=dwd%+%"census/")
out_taxes <- fread(wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv",
select=c("Tax Period","Total")
)[`Tax Period`!=2016]
wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv"
wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv"
wds["data"]
wds
#Data Analysis
#Philadelphia Real Estate Tax Evasion
#  Round 2
#Michael Chirico
#July 29, 2015
#Note: See e-mail "now we're in a hurry" from cloef@sas.upenn.edu
#  for confirmation that June 12 is the day small envelope
#  versions were sent to the DoR Mail Room.
#   See e-mail "Status" from rmcfadden@lawlerdirect.com
#  or "Next steps?" (from same) on June 22
#  for confirmation that June 23 is the postage date for
#  the large envelopes sent by Lawler Direct.
#Setup: Random Seed, Packages,
#  Working Directory, Convenient Functions ####
## @knitr setup
##Random Seed
###Alternating digits (1,3,...) of
###  my CVS Extra Care card number
set.seed(4746966)
##Packages
rm(list=ls(all=T))
gc()
setwd((mn<-"~/Desktop/research/Sieg_LMI_Real_Estate_Delinquency/")%+%
"analysis_code/")
wds<-c(data=(dwd<-"/media/data_drive/")%+%"real_estate/",
proj=mn,
imga=mn%+%"/papers_presentations/round_two/images/analysis/",
imgb=mn%+%"/papers_presentations/round_two/images/balance/",
gis=dwd%+%"gis_data/PA/",
sher=dwd%+%"real_estate/sheriffs_sales/",
cens=dwd%+%"census/")
(mn<-"~/Desktop/research/Sieg_LMI_Real_Estate_Delinquency/")%+%
"analysis_code/"
#Data Analysis
#Philadelphia Real Estate Tax Evasion
#  Round 2
#Michael Chirico
#July 29, 2015
#Note: See e-mail "now we're in a hurry" from cloef@sas.upenn.edu
#  for confirmation that June 12 is the day small envelope
#  versions were sent to the DoR Mail Room.
#   See e-mail "Status" from rmcfadden@lawlerdirect.com
#  or "Next steps?" (from same) on June 22
#  for confirmation that June 23 is the postage date for
#  the large envelopes sent by Lawler Direct.
#Setup: Random Seed, Packages,
#  Working Directory, Convenient Functions ####
## @knitr setup
##Random Seed
###Alternating digits (1,3,...) of
###  my CVS Extra Care card number
set.seed(4746966)
##Packages
rm(list=ls(all=T))
gc()
#Michael Chirico's function of convenience packages;
#  install via devtools::install_github("MichaelChirico/funchir")
library(funchir)
library(data.table)
library(texreg)
library(sandwich)
library(xtable)
library(readxl)
library(xlsx)
library(sp)
library(doParallel)
library(RgoogleMaps)
library(maptools)
library(lmtest)
setwd((mn<-"~/Desktop/research/Sieg_LMI_Real_Estate_Delinquency/")%+%
"analysis_code/")
wds<-c(data=(dwd<-"/media/data_drive/")%+%"real_estate/",
proj=mn,
imga=mn%+%"/papers_presentations/round_two/images/analysis/",
imgb=mn%+%"/papers_presentations/round_two/images/balance/",
gis=dwd%+%"gis_data/PA/",
sher=dwd%+%"real_estate/sheriffs_sales/",
cens=dwd%+%"census/")
write.packages(mn%+%"analysis_code/logs/round_2_analysis_session.txt")
wds
out_taxes <- fread(wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv",
select=c("Tax Period","Total")
)[`Tax Period`!=2016]
out_taxes
out_taxes[Total>0,.N]/nrow(out_taxes)
out_taxes[gsub("\\$","",Total)>0,.N]/nrow(out_taxes)
out_taxes[gsub("\\$","",Total)>0]
out_taxes[gsub("\\$","",Total)>0&`Tax Period` != 2016]
out_taxes <- fread(wds["data"]%+%"Real_Estate_Tax_Balances_151222.csv")
out_taxes
out_taxes[,.N,by="Parcel Number"]
names(out_taxes)
out_taxes[,.N,by=`Parcel Number`]
out_taxes[,.N,by="ÿParcel Number"]
out_taxes[,.N,by="Parcel Number"]
setnames(out_taxes,c("opa_no","owner","location","unit","year","principal","interest","penalty","other","total","lien_no","coordinates"))
out_taxes[,.N,by=opa_no]
out_taxes[,.N,by=opa_no][,table(N)]
x <- seq(0, 2, length.out = 1000)
plot(x, x^2*sqrt(3)/36 + ((2-x)/4)^2, lwd = 3, type = "l")
